<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Guess Who</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 10px;
            font-size: 12px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            font-size: 20px;
        }

        .game-container {
            max-width: 1100px;
            margin: 0 auto;
        }

        #selection-screen {
            text-align: center;
            padding: 10px;
        }

        #selection-screen h2 {
            margin-bottom: 10px;
            color: #ffd700;
            font-size: 16px;
        }

        #selection-screen p {
            font-size: 11px;
            margin-bottom: 8px;
        }

        .player-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 8px;
            margin-top: 8px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .player-card:hover {
            transform: translateY(-2px);
            border-color: #00d4ff;
            box-shadow: 0 3px 10px rgba(0, 212, 255, 0.3);
        }

        .player-card.selected {
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .player-card img {
            width: 100%;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
            background: #333;
        }

        .player-card h3 {
            margin-top: 4px;
            font-size: 9px;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-card .position {
            color: #00d4ff;
            font-size: 9px;
            margin-top: 2px;
        }

        #start-game-btn {
            margin-top: 12px;
            padding: 8px 20px;
            font-size: 13px;
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            border: none;
            border-radius: 18px;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        #start-game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 15px rgba(255, 215, 0, 0.5);
        }

        #game-screen {
            display: none;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 12px;
        }

        .turn-indicator {
            color: #ffd700;
            font-weight: bold;
        }

        .players-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .player-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 8px;
            text-align: center;
        }

        .player-display h2 {
            margin-bottom: 6px;
            color: #00d4ff;
            font-size: 12px;
        }

        .player-display.cpu h2 {
            color: #ff6b6b;
        }

        .player-image-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 6px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #00d4ff;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .player-display.cpu .player-image-container {
            border-color: #ff6b6b;
        }

        .player-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .question-mark {
            font-size: 40px;
            color: #ff6b6b;
        }

        .player-display h3 {
            font-size: 11px;
            margin-bottom: 4px;
        }

        .stats-display {
            text-align: left;
            background: rgba(0, 0, 0, 0.3);
            padding: 6px;
            border-radius: 6px;
            margin-top: 6px;
        }

        .stats-display h3 {
            margin-bottom: 4px;
            color: #ffd700;
            text-align: center;
            font-size: 9px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 1px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 9px;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #aaa;
        }

        .stat-value {
            color: #fff;
            font-weight: bold;
        }

        .question-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin-top: 8px;
        }

        .question-panel h3 {
            margin-bottom: 8px;
            color: #ffd700;
            text-align: center;
            font-size: 12px;
        }

        .question-type-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
            justify-content: center;
        }

        .question-type-btn {
            padding: 5px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #00d4ff;
            border-radius: 12px;
            color: #00d4ff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 10px;
        }

        .question-type-btn:hover, .question-type-btn.active {
            background: #00d4ff;
            color: #1a1a2e;
        }

        .question-form {
            display: none;
            flex-direction: column;
            gap: 6px;
            align-items: center;
        }

        .question-form.active {
            display: flex;
        }

        .form-row {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            font-size: 10px;
        }

        select, input {
            padding: 5px 8px;
            border-radius: 5px;
            border: 2px solid #00d4ff;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 10px;
        }

        input[type="number"] {
            width: 60px;
        }

        select option {
            background: #1a1a2e;
        }

        .ask-btn, .guess-btn {
            padding: 5px 14px;
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 10px;
        }

        .ask-btn:hover, .guess-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 12px rgba(0, 212, 255, 0.5);
        }

        .guess-btn {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            color: #1a1a2e;
        }

        .cpu-question-panel {
            background: rgba(255, 107, 107, 0.1);
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            display: none;
            margin-top: 8px;
        }

        .cpu-question-panel.active {
            display: block;
        }

        .cpu-question-panel h3 {
            color: #ff6b6b;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .cpu-question-text {
            font-size: 12px;
            margin-bottom: 10px;
            color: #fff;
            padding: 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
        }

        .answer-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .answer-btn {
            padding: 6px 25px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 11px;
        }

        .answer-btn.yes {
            background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
            color: #1a1a2e;
        }

        .answer-btn.no {
            background: linear-gradient(135deg, #ff6b6b 0%, #cc0000 100%);
            color: #fff;
        }

        .answer-btn:hover {
            transform: scale(1.05);
        }

        .bottom-section {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 8px;
            margin-top: 8px;
        }

        .game-log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 8px;
            max-height: 120px;
            overflow-y: auto;
        }

        .game-log h3 {
            margin-bottom: 6px;
            color: #00d4ff;
            font-size: 11px;
        }

        .log-entry {
            padding: 4px 6px;
            margin-bottom: 4px;
            border-radius: 4px;
            font-size: 9px;
        }

        .log-entry.user {
            background: rgba(0, 212, 255, 0.2);
            border-left: 3px solid #00d4ff;
        }

        .log-entry.cpu {
            background: rgba(255, 107, 107, 0.2);
            border-left: 3px solid #ff6b6b;
        }

        .log-entry.system {
            background: rgba(255, 215, 0, 0.2);
            border-left: 3px solid #ffd700;
        }

        .remaining-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 8px;
        }

        .remaining-section h3 {
            margin-bottom: 6px;
            color: #ffd700;
            text-align: center;
            font-size: 10px;
        }

        .remaining-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));
            gap: 4px;
            max-height: 120px;
            overflow-y: auto;
        }

        .remaining-player {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px;
            border-radius: 6px;
            text-align: center;
            font-size: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .remaining-player:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .remaining-player.eliminated {
            opacity: 0.3;
            text-decoration: line-through;
            cursor: default;
        }

        .remaining-player.eliminated:hover {
            transform: none;
            background: rgba(255, 255, 255, 0.1);
        }

        .remaining-player img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 2px;
            background: #333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            max-width: 350px;
            border: 2px solid #ffd700;
        }

        .modal-content h2 {
            font-size: 24px;
            margin-bottom: 12px;
        }

        .modal-content.win h2 {
            color: #00ff00;
        }

        .modal-content.lose h2 {
            color: #ff6b6b;
        }

        .modal-content p {
            margin-bottom: 15px;
            font-size: 12px;
        }

        .play-again-btn {
            padding: 8px 25px;
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            border: none;
            border-radius: 18px;
            color: #1a1a2e;
            font-weight: bold;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-again-btn:hover {
            transform: scale(1.05);
        }

        .stats-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .stats-modal.active {
            display: flex;
        }

        .stats-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            min-width: 200px;
            border: 2px solid #00d4ff;
            position: relative;
        }

        .stats-modal-content .close-btn {
            position: absolute;
            top: 6px;
            right: 10px;
            font-size: 18px;
            cursor: pointer;
            color: #aaa;
        }

        .stats-modal-content .close-btn:hover {
            color: #fff;
        }

        .stats-modal-content img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 8px;
            border: 3px solid #00d4ff;
        }

        .stats-modal-content h3 {
            color: #00d4ff;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .stats-modal-content .position-badge {
            color: #ffd700;
            font-size: 11px;
            margin-bottom: 8px;
        }

        .stats-modal-content .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 3px 8px;
            font-size: 10px;
        }

        .guess-panel-inline {
            display: flex;
            gap: 6px;
            align-items: center;
            justify-content: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>NFL Guess Who</h1>

        <div id="selection-screen">
            <h2>Select Your Player</h2>
            <p>Choose a player for the CPU to guess. You'll also try to guess the CPU's player!</p>
            <div class="player-grid" id="player-grid"></div>
            <button id="start-game-btn" onclick="startGame()">Start Game</button>
        </div>

        <div id="game-screen">
            <div class="game-header">
                <div class="turn-indicator" id="turn-indicator">Your Turn</div>
                <div>Turn: <span id="turn-count">1</span> | Remaining: <span id="remaining-count">75</span></div>
            </div>

            <div class="players-display">
                <div class="player-display user">
                    <h2>Your Player</h2>
                    <div class="player-image-container">
                        <img id="user-player-img" src="" alt="Your Player">
                    </div>
                    <h3 id="user-player-name"></h3>
                    <div class="stats-display">
                        <h3>Your Stats (Answer CPU Questions)</h3>
                        <div class="stat-row">
                            <span class="stat-label">Position:</span>
                            <span class="stat-value" id="user-position"></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Pass Yds:</span>
                            <span class="stat-value" id="user-passing-yards"></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Pass TDs:</span>
                            <span class="stat-value" id="user-passing-tds"></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Rush Yds:</span>
                            <span class="stat-value" id="user-rushing-yards"></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Rush TDs:</span>
                            <span class="stat-value" id="user-rushing-tds"></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Rec Yds:</span>
                            <span class="stat-value" id="user-receiving-yards"></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Rec TDs:</span>
                            <span class="stat-value" id="user-receiving-tds"></span>
                        </div>
                    </div>
                </div>

                <div class="player-display cpu">
                    <h2>CPU's Player</h2>
                    <div class="player-image-container">
                        <span class="question-mark">?</span>
                    </div>
                    <h3>Mystery Player</h3>
                    <div class="stats-display">
                        <h3>Narrow it down!</h3>
                        <p style="font-size:9px; color:#aaa; text-align:center;">Ask questions or click players below to view their stats</p>
                    </div>
                </div>
            </div>

            <div class="question-panel" id="question-panel">
                <h3>Ask a Question</h3>
                <div class="question-type-selector">
                    <button class="question-type-btn active" onclick="selectQuestionType('position')">Position</button>
                    <button class="question-type-btn" onclick="selectQuestionType('stat')">Stats</button>
                </div>

                <div class="question-form active" id="position-form">
                    <div class="form-row">
                        <label>Is the player a</label>
                        <select id="position-select">
                            <option value="QB">QB</option>
                            <option value="RB">RB</option>
                            <option value="WR">WR</option>
                            <option value="TE">TE</option>
                        </select>
                        <label>?</label>
                        <button class="ask-btn" onclick="askPositionQuestion()">Ask</button>
                    </div>
                </div>

                <div class="question-form" id="stat-form">
                    <div class="form-row">
                        <label>Is</label>
                        <select id="stat-select">
                            <option value="passingYards">Pass Yds</option>
                            <option value="passingTDs">Pass TDs</option>
                            <option value="rushingYards">Rush Yds</option>
                            <option value="rushingTDs">Rush TDs</option>
                            <option value="receivingYards">Rec Yds</option>
                            <option value="receivingTDs">Rec TDs</option>
                        </select>
                        <select id="comparison-select">
                            <option value="greater">></option>
                            <option value="less"><</option>
                            <option value="equal">=</option>
                        </select>
                        <input type="number" id="stat-value" placeholder="Value" min="0">
                        <button class="ask-btn" onclick="askStatQuestion()">Ask</button>
                    </div>
                </div>

                <div class="guess-panel-inline">
                    <select id="guess-select"></select>
                    <button class="guess-btn" onclick="makeGuess()">Guess!</button>
                </div>
            </div>

            <div class="cpu-question-panel" id="cpu-question-panel">
                <h3>CPU Asks:</h3>
                <div class="cpu-question-text" id="cpu-question-text"></div>
                <p style="font-size: 9px; color: #aaa; margin-bottom: 8px;">Check your stats above and answer truthfully!</p>
                <div class="answer-buttons">
                    <button class="answer-btn yes" onclick="answerCpuQuestion(true)">YES</button>
                    <button class="answer-btn no" onclick="answerCpuQuestion(false)">NO</button>
                </div>
            </div>

            <div class="bottom-section">
                <div class="game-log">
                    <h3>Game Log</h3>
                    <div id="log-entries"></div>
                </div>

                <div class="remaining-section">
                    <h3>Possible CPU Players (Click for Stats)</h3>
                    <div class="remaining-grid" id="remaining-grid"></div>
                </div>
            </div>
        </div>

        <div class="modal" id="game-modal">
            <div class="modal-content" id="modal-content">
                <h2 id="modal-title"></h2>
                <p id="modal-message"></p>
                <button class="play-again-btn" onclick="resetGame()">Play Again</button>
            </div>
        </div>

        <div class="stats-modal" id="stats-modal" onclick="closeStatsModal(event)">
            <div class="stats-modal-content" onclick="event.stopPropagation()">
                <span class="close-btn" onclick="closeStatsModal()">&times;</span>
                <img id="modal-player-img" src="" alt="">
                <h3 id="modal-player-name"></h3>
                <div class="position-badge" id="modal-player-position"></div>
                <div class="stat-row">
                    <span class="stat-label">Passing Yards:</span>
                    <span class="stat-value" id="modal-passing-yards"></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Passing TDs:</span>
                    <span class="stat-value" id="modal-passing-tds"></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Rushing Yards:</span>
                    <span class="stat-value" id="modal-rushing-yards"></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Rushing TDs:</span>
                    <span class="stat-value" id="modal-rushing-tds"></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Receiving Yards:</span>
                    <span class="stat-value" id="modal-receiving-yards"></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Receiving TDs:</span>
                    <span class="stat-value" id="modal-receiving-tds"></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let players = [];
        let userPlayer = null;
        let cpuPlayer = null;
        let remainingPlayers = [];
        let cpuRemainingPlayers = [];
        let isUserTurn = true;
        let turnCount = 1;
        let gameOver = false;
        let currentCpuQuestion = null;

        // Load CSV from file (works on server) or use embedded fallback (works locally)
        async function loadCSV() {
            try {
                const response = await fetch('player_data.csv');
                if (!response.ok) throw new Error('Fetch failed');
                const text = await response.text();
                return parseCSV(text);
            } catch (error) {
                console.log('CSV fetch failed, using embedded data');
                return null;
            }
        }

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length < 10) continue;
                data.push({
                    id: values[1].replace(/"/g,''),
                    name: values[2].replace(/"/g,''),
                    position: values[3].replace(/"/g,''),
                    passingYards: parseInt(values[4]) || 0,
                    passingTDs: parseInt(values[5]) || 0,
                    rushingYards: parseInt(values[6]) || 0,
                    rushingTDs: parseInt(values[7]) || 0,
                    receivingYards: parseInt(values[8]) || 0,
                    receivingTDs: parseInt(values[9]) || 0,
                    picture: values[10].replace(/"/g,'')
                });
            }
            return data;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') inQuotes = !inQuotes;
                else if (char === ',' && !inQuotes) { result.push(current.trim()); current = ''; }
                else current += char;
            }
            result.push(current.trim());
            return result;
        }

        // Embedded fallback data (minimal version for local testing)
        const fallbackPlayers = [
            {id:"00-0033873",name:"Patrick Mahomes",position:"QB",passingYards:3587,passingTDs:22,rushingYards:422,rushingTDs:5,receivingYards:-10,receivingTDs:0,picture:"https://static.www.nfl.com/image/upload/f_auto,q_auto/league/iireqbn32cpg9fn4sfy7"},
            {id:"00-0032764",name:"Derrick Henry",position:"RB",passingYards:0,passingTDs:0,rushingYards:1595,rushingTDs:16,receivingYards:150,receivingTDs:0,picture:"https://static.www.nfl.com/image/upload/f_auto,q_auto/league/jxtikemnvpkw9r0ex2wv"},
            {id:"00-0036900",name:"Ja'Marr Chase",position:"WR",passingYards:0,passingTDs:0,rushingYards:14,rushingTDs:0,receivingYards:1412,receivingTDs:8,picture:"https://static.www.nfl.com/image/upload/f_auto,q_auto/league/qya3dtjb5kgofcuj2tuw"},
            {id:"00-0030506",name:"Travis Kelce",position:"TE",passingYards:0,passingTDs:0,rushingYards:1,rushingTDs:0,receivingYards:851,receivingTDs:5,picture:"https://static.www.nfl.com/image/upload/f_auto,q_auto/league/ebc5j60djpinc9elvlc5"},
            {id:"00-0034857",name:"Josh Allen",position:"QB",passingYards:3668,passingTDs:25,rushingYards:579,rushingTDs:14,receivingYards:0,receivingTDs:0,picture:"https://static.www.nfl.com/image/upload/f_auto,q_auto/league/servs1fpsynfxep4rz2z"}
        ];

        // Initialize game
        async function init() {
            document.getElementById('player-grid').innerHTML = '<p style="color:#ffd700;">Loading players...</p>';
            const csvPlayers = await loadCSV();
            players = csvPlayers || fallbackPlayers;
            renderPlayerSelection();
        }

        // Get optimized image URL (smaller, compressed)
        function getSmallImage(url) {
            // Add Cloudinary params for smaller images: 80px wide, 60% quality
            return url.replace('/f_auto,q_auto/', '/f_auto,q_50,w_80,h_80,c_fill/');
        }

        function getMediumImage(url) {
            // Medium size for player display: 120px
            return url.replace('/f_auto,q_auto/', '/f_auto,q_60,w_120,h_120,c_fill/');
        }

        // Render player selection grid
        function renderPlayerSelection() {
            const grid = document.getElementById('player-grid');
            grid.innerHTML = '';

            players.forEach((player, index) => {
                const card = document.createElement('div');
                card.className = 'player-card';
                card.onclick = () => selectPlayer(player, index);
                card.innerHTML = `
                    <img src="${getSmallImage(player.picture)}" alt="${player.name}" loading="lazy" onerror="this.src='https://via.placeholder.com/100?text=?'">
                    <h3>${player.name}</h3>
                    <div class="position">${player.position}</div>
                `;
                card.id = `card-${index}`;
                grid.appendChild(card);
            });
        }

        // Select a player
        function selectPlayer(player, index) {
            document.querySelectorAll('.player-card').forEach(card => card.classList.remove('selected'));
            userPlayer = player;
            userPlayer._index = index;
            document.getElementById(`card-${index}`).classList.add('selected');
            document.getElementById('start-game-btn').style.display = 'inline-block';
        }

        // Start the game
        function startGame() {
            if (!userPlayer) return;

            const availablePlayers = players.filter((p, i) => i !== userPlayer._index);
            cpuPlayer = availablePlayers[Math.floor(Math.random() * availablePlayers.length)];

            remainingPlayers = [...players];
            cpuRemainingPlayers = [...players];

            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';

            displayUserPlayer();
            populateGuessDropdown();
            renderRemainingPlayers();

            addLog('Game started! Try to guess the CPU\'s player!', 'system');
        }

        // Display user's player info
        function displayUserPlayer() {
            document.getElementById('user-player-img').src = getMediumImage(userPlayer.picture);
            document.getElementById('user-player-name').textContent = userPlayer.name;
            document.getElementById('user-position').textContent = userPlayer.position;
            document.getElementById('user-passing-yards').textContent = userPlayer.passingYards.toLocaleString();
            document.getElementById('user-passing-tds').textContent = userPlayer.passingTDs;
            document.getElementById('user-rushing-yards').textContent = userPlayer.rushingYards.toLocaleString();
            document.getElementById('user-rushing-tds').textContent = userPlayer.rushingTDs;
            document.getElementById('user-receiving-yards').textContent = userPlayer.receivingYards.toLocaleString();
            document.getElementById('user-receiving-tds').textContent = userPlayer.receivingTDs;
        }

        // Populate guess dropdown
        function populateGuessDropdown() {
            const select = document.getElementById('guess-select');
            select.innerHTML = '';
            remainingPlayers.forEach((player, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = player.name;
                select.appendChild(option);
            });
        }

        // Render remaining players grid
        function renderRemainingPlayers() {
            const grid = document.getElementById('remaining-grid');
            grid.innerHTML = '';

            players.forEach((player) => {
                const div = document.createElement('div');
                div.className = 'remaining-player';
                const isEliminated = !remainingPlayers.includes(player);
                if (isEliminated) div.classList.add('eliminated');
                div.innerHTML = `
                    <img src="${getSmallImage(player.picture)}" alt="${player.name}" loading="lazy" onerror="this.src='https://via.placeholder.com/40?text=?'">
                    <div>${player.name.split(' ').pop()}</div>
                `;
                if (!isEliminated) div.onclick = () => showPlayerStats(player);
                grid.appendChild(div);
            });

            document.getElementById('remaining-count').textContent = remainingPlayers.length;
        }

        // Show player stats modal
        function showPlayerStats(player) {
            document.getElementById('modal-player-img').src = getMediumImage(player.picture);
            document.getElementById('modal-player-name').textContent = player.name;
            document.getElementById('modal-player-position').textContent = player.position;
            document.getElementById('modal-passing-yards').textContent = player.passingYards.toLocaleString();
            document.getElementById('modal-passing-tds').textContent = player.passingTDs;
            document.getElementById('modal-rushing-yards').textContent = player.rushingYards.toLocaleString();
            document.getElementById('modal-rushing-tds').textContent = player.rushingTDs;
            document.getElementById('modal-receiving-yards').textContent = player.receivingYards.toLocaleString();
            document.getElementById('modal-receiving-tds').textContent = player.receivingTDs;
            document.getElementById('stats-modal').classList.add('active');
        }

        // Close stats modal
        function closeStatsModal(event) {
            if (!event || event.target.id === 'stats-modal') {
                document.getElementById('stats-modal').classList.remove('active');
            }
        }

        // Select question type
        function selectQuestionType(type) {
            document.querySelectorAll('.question-type-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.question-form').forEach(form => form.classList.remove('active'));

            if (type === 'position') {
                document.querySelector('.question-type-btn:nth-child(1)').classList.add('active');
                document.getElementById('position-form').classList.add('active');
            } else {
                document.querySelector('.question-type-btn:nth-child(2)').classList.add('active');
                document.getElementById('stat-form').classList.add('active');
            }
        }

        // Ask position question
        function askPositionQuestion() {
            if (!isUserTurn || gameOver) return;

            const position = document.getElementById('position-select').value;
            const answer = cpuPlayer.position === position;

            addLog(`You: Is the player a ${position}? - ${answer ? 'YES' : 'NO'}`, 'user');

            remainingPlayers = remainingPlayers.filter(p => answer ? p.position === position : p.position !== position);

            renderRemainingPlayers();
            populateGuessDropdown();
            checkWinCondition();

            if (!gameOver) endUserTurn();
        }

        // Ask stat question
        function askStatQuestion() {
            if (!isUserTurn || gameOver) return;

            const stat = document.getElementById('stat-select').value;
            const comparison = document.getElementById('comparison-select').value;
            const value = parseInt(document.getElementById('stat-value').value);

            if (isNaN(value)) {
                alert('Please enter a valid number');
                return;
            }

            const cpuValue = cpuPlayer[stat];
            let answer;

            switch (comparison) {
                case 'greater': answer = cpuValue > value; break;
                case 'less': answer = cpuValue < value; break;
                case 'equal': answer = cpuValue === value; break;
            }

            const statNames = {passingYards:'Pass Yds',passingTDs:'Pass TDs',rushingYards:'Rush Yds',rushingTDs:'Rush TDs',receivingYards:'Rec Yds',receivingTDs:'Rec TDs'};
            const compSymbol = comparison === 'greater' ? '>' : comparison === 'less' ? '<' : '=';
            addLog(`You: Is ${statNames[stat]} ${compSymbol} ${value}? - ${answer ? 'YES' : 'NO'}`, 'user');

            remainingPlayers = remainingPlayers.filter(p => {
                const pValue = p[stat];
                switch (comparison) {
                    case 'greater': return answer ? pValue > value : pValue <= value;
                    case 'less': return answer ? pValue < value : pValue >= value;
                    case 'equal': return answer ? pValue === value : pValue !== value;
                }
            });

            renderRemainingPlayers();
            populateGuessDropdown();
            checkWinCondition();

            if (!gameOver) endUserTurn();
        }

        // Make a guess
        function makeGuess() {
            if (!isUserTurn || gameOver) return;

            const guessIndex = parseInt(document.getElementById('guess-select').value);
            const guessedPlayer = remainingPlayers[guessIndex];

            addLog(`You guessed: ${guessedPlayer.name}!`, 'user');

            if (guessedPlayer.id === cpuPlayer.id) {
                endGame(true, `You correctly guessed ${cpuPlayer.name}!`);
            } else {
                addLog(`Wrong! It was ${cpuPlayer.name}.`, 'system');
                endGame(false, `Wrong guess! The CPU's player was ${cpuPlayer.name}.`);
            }
        }

        // End user turn and start CPU turn
        function endUserTurn() {
            isUserTurn = false;
            document.getElementById('turn-indicator').textContent = "CPU's Turn";
            document.getElementById('question-panel').style.display = 'none';
            setTimeout(cpuTurn, 1000);
        }

        // CPU Turn
        function cpuTurn() {
            if (gameOver) return;

            if (cpuRemainingPlayers.length === 1) {
                const guess = cpuRemainingPlayers[0];
                addLog(`CPU guesses: ${guess.name}!`, 'cpu');

                if (guess.id === userPlayer.id) {
                    endGame(false, `CPU correctly guessed your player: ${userPlayer.name}!`);
                } else {
                    addLog(`CPU guessed wrong!`, 'system');
                    startUserTurn();
                }
                return;
            }

            currentCpuQuestion = findBestQuestion();
            document.getElementById('cpu-question-text').textContent = currentCpuQuestion.text;
            document.getElementById('cpu-question-panel').classList.add('active');
            addLog(`CPU asks: ${currentCpuQuestion.text}`, 'cpu');
        }

        // User answers CPU's question
        function answerCpuQuestion(answer) {
            document.getElementById('cpu-question-panel').classList.remove('active');
            addLog(`You answered: ${answer ? 'YES' : 'NO'}`, 'system');

            cpuRemainingPlayers = cpuRemainingPlayers.filter(p => evaluateQuestion(currentCpuQuestion, p) === answer);
            addLog(`CPU narrowed to ${cpuRemainingPlayers.length} players.`, 'cpu');

            turnCount++;
            document.getElementById('turn-count').textContent = turnCount;
            currentCpuQuestion = null;
            startUserTurn();
        }

        // Find the best question for CPU (closest to 50% split)
        function findBestQuestion() {
            const questions = [];
            const total = cpuRemainingPlayers.length;
            const target = total / 2;

            const positions = [...new Set(cpuRemainingPlayers.map(p => p.position))];
            positions.forEach(pos => {
                const count = cpuRemainingPlayers.filter(p => p.position === pos).length;
                questions.push({type:'position',value:pos,text:`Is your player a ${pos}?`,split:Math.abs(count-target)});
            });

            const stats = ['passingYards','passingTDs','rushingYards','rushingTDs','receivingYards','receivingTDs'];
            const statNames = {passingYards:'Passing Yards',passingTDs:'Passing TDs',rushingYards:'Rushing Yards',rushingTDs:'Rushing TDs',receivingYards:'Receiving Yards',receivingTDs:'Receiving TDs'};

            stats.forEach(stat => {
                const values = cpuRemainingPlayers.map(p => p[stat]).sort((a,b) => a-b);
                const medianValue = values[Math.floor(values.length/2)];

                const countGreater = cpuRemainingPlayers.filter(p => p[stat] > medianValue).length;
                if (countGreater > 0 && countGreater < total) {
                    questions.push({type:'stat',stat:stat,comparison:'greater',value:medianValue,text:`Is your ${statNames[stat]} greater than ${medianValue}?`,split:Math.abs(countGreater-target)});
                }

                const q1 = values[Math.floor(values.length/4)];
                const q3 = values[Math.floor(3*values.length/4)];
                [q1,q3].forEach(val => {
                    if (val !== undefined && val !== medianValue) {
                        const ct = cpuRemainingPlayers.filter(p => p[stat] > val).length;
                        if (ct > 0 && ct < total) {
                            questions.push({type:'stat',stat:stat,comparison:'greater',value:val,text:`Is your ${statNames[stat]} greater than ${val}?`,split:Math.abs(ct-target)});
                        }
                    }
                });
            });

            questions.sort((a,b) => a.split - b.split);
            return questions[0] || {type:'position',value:'QB',text:'Is your player a QB?',split:0};
        }

        // Evaluate a question against a player
        function evaluateQuestion(question, player) {
            if (question.type === 'position') return player.position === question.value;
            const playerValue = player[question.stat];
            switch (question.comparison) {
                case 'greater': return playerValue > question.value;
                case 'less': return playerValue < question.value;
                case 'equal': return playerValue === question.value;
            }
        }

        // Start user turn
        function startUserTurn() {
            isUserTurn = true;
            document.getElementById('turn-indicator').textContent = "Your Turn";
            document.getElementById('question-panel').style.display = 'block';
        }

        // Check win condition
        function checkWinCondition() {
            if (remainingPlayers.length === 1) {
                addLog(`Only ${remainingPlayers[0].name} remains!`, 'system');
            }
        }

        // Add log entry
        function addLog(message, type) {
            const logEntries = document.getElementById('log-entries');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            logEntries.insertBefore(entry, logEntries.firstChild);
        }

        // End game
        function endGame(userWins, message) {
            gameOver = true;
            const modal = document.getElementById('game-modal');
            const content = document.getElementById('modal-content');
            content.className = 'modal-content ' + (userWins ? 'win' : 'lose');
            document.getElementById('modal-title').textContent = userWins ? 'YOU WIN!' : 'YOU LOSE!';
            document.getElementById('modal-message').textContent = message;
            modal.classList.add('active');
        }

        // Reset game
        function resetGame() {
            userPlayer = null;
            cpuPlayer = null;
            remainingPlayers = [];
            cpuRemainingPlayers = [];
            isUserTurn = true;
            turnCount = 1;
            gameOver = false;
            currentCpuQuestion = null;

            document.getElementById('game-modal').classList.remove('active');
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('selection-screen').style.display = 'block';
            document.getElementById('log-entries').innerHTML = '';
            document.getElementById('turn-count').textContent = '1';
            document.getElementById('start-game-btn').style.display = 'none';
            document.getElementById('question-panel').style.display = 'block';
            document.getElementById('cpu-question-panel').classList.remove('active');

            renderPlayerSelection();
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
